<div class="page" *ngIf="servicio.sorteoActual() as sorteo">
  <header class="topbar">
    <button class="ghost" (click)="volver()">← Volver a sorteos</button>
    <h3>Panel de Administración</h3>
  </header>

  <section class="info">
    <div class="sub">
      {{ sorteo.name }} — Organizado por {{ sorteo.organizer }}
      <span class="alias">(@{{ sorteo.alias }})</span>
    </div>

    <div class="actions">
      <a class="ghost" [routerLink]="['/admin', sorteo.id, 'edit']">Editar sorteo</a>
      <a class="ghost" [routerLink]="['/admin', sorteo.id, 'resultado']">Publicar resultado</a>
    </div>
  </section>

  <section class="countdown">
    <div class="count-card">
      <div class="label">Tiempo restante para el sorteo</div>
      <app-countdown [targetIso]="sorteo.raffleDate"></app-countdown>
      <div class="when">Programado para: {{ sorteo.raffleDate | date:'long' }}</div>
    </div>
  </section>

  <app-stats-cards
    [sold]="servicio.calcularEstadisticas(sorteo).vendidos"
    [available]="servicio.calcularEstadisticas(sorteo).disponibles"
    [processing]="servicio.calcularEstadisticas(sorteo).procesando"
    [revenue]="servicio.calcularEstadisticas(sorteo).recaudacion"
    [total]="sorteo.numbers.length"
  ></app-stats-cards>

  <section class="table">
    <div class="toolbar">
      <button class="ghost" (click)="exportarCSV()">Exportar CSV</button>
    </div>
    <app-buyers-table [buyers]="sorteo.buyers"></app-buyers-table>
  </section>
</div>
